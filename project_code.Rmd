---
title: "Final Project"
author: "Kyle Lewald"
date: "4/25/16"
output: 
  html_document:
    fig_height: 3
    fig_width: 5
---
<!-- Don't edit in between this line and the one below -->
```{r include=FALSE}
# Don't delete this chunk if you are using the DataComputing package
library(DataComputing)
library(ggmap)
```
*Source file* 
```{r, results='asis', echo=FALSE}
includeSourceDocuments()
```
<!-- Don't edit the material above this line -->


```{r echo=FALSE} 
#reading in the data in windows
taxi_passengers <- read.csv("C:\\Users\\Kyle\\Dropbox\\Link_Erasmus_Documents\\STAT133\\Final Project\\Taxi_Report\\taxi_passengers_sample.csv")


taxi_passengers <- taxi_passengers %>%
  select(Pickup_Time, Dropoff_Time, Passengers, Pickup_Long, Pickup_Lat, Dropoff_Long, Dropoff_Lat)

names(taxi_passengers) <- c("Pickup_Time", "Dropoff_Time", "Passengers", "pickup_longitude", "pickup_latitude", "dropoff_longitude", "dropoff_latitude")

Filtered <- taxi_passengers %>% 
  filter(pickup_longitude != 0, pickup_latitude != 0, dropoff_longitude != 0, dropoff_latitude != 0)


head(Filtered)
```

```{r echo=FALSE}
#processing
increment <- 500


LowerLat <- min(min(Filtered$pickup_latitude), min(Filtered$dropoff_latitude))-0.00001
UpperLat <- max(max(Filtered$pickup_latitude), max(Filtered$dropoff_latitude))+0.00001
LowerLon <- min(min(Filtered$pickup_longitude), min(Filtered$dropoff_longitude))-0.00001
UpperLon <- max(max(Filtered$pickup_longitude), max(Filtered$dropoff_longitude))+0.00001
LatIncrements <- (UpperLat - LowerLat)/(increment)
LonIncrements <- (UpperLon - LowerLon)/(increment)


round_coord <- function(coordinate, min, max) {
  unit <- ((abs(max-min))/increment)
  rounded <-(unit)*(round((coordinate/unit), 0))
  return(rounded)
}

Rounded <- Filtered %>%
  mutate(dropoff_latitude = round_coord(dropoff_latitude, LowerLat, UpperLat),
         dropoff_longitude = round_coord(dropoff_longitude, LowerLon, UpperLon)) %>%
  group_by(dropoff_longitude, dropoff_latitude)%>%
  summarise(count = n()) %>%
  arrange(desc(dropoff_longitude))

head(Rounded)
```

```{r fig.width=5, fig.height=5}
#mapping points
NYC_map <-get_map(location = 'New York City', zoom = 11)

ggmap(NYC_map) +
  geom_tile(data=Rounded,aes(x=dropoff_longitude, y=dropoff_latitude, alpha=count), fill='red')
```

